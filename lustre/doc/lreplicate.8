.TH lreplicate 8 "2009 Apr 08" Lustre "Lustre Filesystem replication utility"
.SH NAME
lreplicate \- Utility to replicate a Lustre Filesystem
.SH SYNOPSIS
.br
.B lreplicate --source|-s <src> --target|-t <tgt> 
.br
.B\t\t\t --mdt|-m <mdt>  [--user|-u <user id>] 
.br
.B\t\t\t [--xattr|-x <yes|no>] [--verbose|-v]
.br
.B\t\t\t [--statuslog|-l <log>] [--dry-run] [--abort-on-err]
.br

.br
.B lreplicate  --statuslog|-l <log>
.br

.br
.B lreplicate  --statuslog|-l <log> --source|-s <source>
.br
.br
.B\t\t\t --target|-t <tgt> --mdt|-m <mdt>
.SH DESCRIPTION
.B lreplicate
can be used to replicate a lustre filesystem (source filesystem) to
another target filesystem (any filesystem type). It is required that
changelogs be enabled on the source filesystem (see lctl (8)).

The source and the target filesystems must be identical before
changelogs are enabled. If the source filesystem has been populated
before turning on changelogs, a utility like rsync may be used to make
them identical.

.SH OPTIONS
.B --source=<src>
.br
The source filesytem which will be replicated. Mandatory if a valid
statuslog created during an previous replication operation
(--statuslog) is not specified.

.B --target=<tgt>
.br
The filesystem to which the source filesystem is replicated. Mandatory
if a valid statuslog created during an previous replication operation
(--statuslog) is not specified. This option can be repeated if
multiple replication targets are desired.

.B --mdt=<mdt>
.br
The metadata device which is to be replicated. Changelogs must be
turned on on this device. Mandatory if a valid statuslog created
during an previous replication operation (--statuslog) is not
specified.

.B --user=<user id>
.br
The changelog user id. See lctl(8) changelog_register. Mandatory if a
valid statuslog created during an previous replication operation
(--statuslog) is not specified.

.B --statuslog=<log>
.br
A status log file to which the status of replication is saved. At the
time of initialization, the state from a previous replication
operation which was saved, can be read and reused.

If a statuslog from a previous replication operation is specified, the
otherwise mandatory options like --source, --target and --mdt may be
skipped.

By specifying the options like --source, --target and --mdt in
addition to the --statuslog option, the parameters in the statuslog
can be overridden. The command line options take precedence over the
ones from the statuslog.

.B --xattr <yes|no>
.br
Specify whether extended attributes are replicated or not. The default
is to replicate extended attributes. Disabling xattrs will mean that
striping information will not be replicated.

.B --verbose
.br
Produce a verbose output.

.B --dry-run
.br
Shows what the program would do without actually replicating data.

.B --abort-on-err
.br
Stop processing upon first error.  Default is to continue processing.

.SH EXAMPLES

.TP
Register a changelog consumer for MDT lustre-MDT0000
$ ssh $MDS lctl changelog_register --device lustre-MDT0000 -n
.br
1

.TP
Replicate the lustre filesystem /mnt/lustre to /mnt/target.
$ lreplicate --source=/mnt/lustre --target=/mnt/target \\ 
.br
             --mdt=lustre-MDT0000 --user=1 \\
.br
             --statuslog replicate.log  --verbose
.br
Lustre filesystem: lustre
.br
MDT device: lustre-MDT0000
.br
Source: /mnt/lustre
.br
Target: /mnt/target
.br
Statuslog: replicate.log
.br
Changelog registration: cl1
.br
Starting changelog record: 0
.br
Errors: 0
.br
lreplicate took 1 seconds
.br
Changelog records consumed: 22
.br


.TP
After the filesystem undergoes some changes, replicate the \
changes. Only the statuslog needs to be specified as it has all the \
parameters passed earlier.
.br
$ lreplicate --statuslog replicate.log --verbose
.br
Replicating Lustre filesystem: lustre
.br
MDT device: lustre-MDT0000
.br
Source: /mnt/lustre
.br
Target: /mnt/target
.br
Statuslog: replicate.log
.br
Changelog registration: cl1
.br
Starting changelog record: 22
.br
Errors: 0
.br
lreplicate took 2 seconds
.br
Changelog records consumed: 42
.br

.TP
To replicate the lustre filesystem /mnt/lustre to /mnt/target1 and /mnt/target2.
$ lreplicate --source=/mnt/lustre \\ 
.br
             --target=/mnt/target1 --target=/mnt/target2 \\ 
.br
             --mdt=lustre-MDT0000 --user=cl1
.br
             --statuslog replicate.log
.br


.SH AUTHOR
The lreplicate command is part of the Lustre filesystem. Contact
http://www.lustre.org/

.SH SEE ALSO
.BR lctl (8),
.BR lfs (1)
