# Copyright (C) 2001-2003 Cluster File Systems, Inc.
#
# This code is issued under the GNU General Public License.
# See the file COPYING in this distribution

AC_INIT
AC_CANONICAL_SYSTEM

# Automake variables.  Steal the version number from lustre.spec.in.
AM_INIT_AUTOMAKE(lustre, builtin([esyscmd], [sed -ne '/^%define version /{ s/.*version //; p; q; }' scripts/lustre.spec.in]))
#AM_MAINTAINER_MODE

# LLNL patches their ext3 and calls it extN
AC_ARG_ENABLE(extN, [  --enable-extN use extN instead of ext3 for lustre backend])
AM_CONDITIONAL(EXTN, test x$enable_extN = xyes)

AC_ARG_WITH(obd-buffer-size, [  --with-obd-buffer-size=[size] set lctl ioctl maximum (default=8K)],OBD_BUFFER_SIZE=$with_obd_buffer_size,OBD_BUFFER_SIZE=8192)
AC_SUBST(OBD_BUFFER_SIZE)

sinclude(portals/build.m4)
sinclude(portals/archdep.m4)

if test x$enable_inkernel = xyes ; then
cp Makefile.mk Makefile.in
cp mds/Makefile.mk mds/Makefile.in
cp portals/Kernelenv.mk portals/Kernelenv.in
cp portals/Makefile.mk portals/Makefile.in
cp portals/libcfs/Makefile.mk portals/libcfs/Makefile.in
cp portals/portals/Makefile.mk portals/portals/Makefile.in
cp portals/knals/Makefile.mk portals/knals/Makefile.in
cp portals/knals/socknal/Makefile.mk portals/knals/socknal/Makefile.in
cp portals/router/Makefile.mk portals/router/Makefile.in
fi

AM_CONFIG_HEADER(portals/include/config.h)

AC_OUTPUT([Makefile portals/Makefile portals/Kernelenv \
          portals/libcfs/Makefile portals/portals/Makefile \
          portals/unals/Makefile portals/knals/Makefile \
          portals/router/Makefile portals/knals/socknal/Makefile \
          portals/knals/gmnal/Makefile portals/knals/qswnal/Makefile \
	  portals/knals/scimacnal/Makefile portals/knals/toenal/Makefile \
          portals/utils/Makefile portals/tests/Makefile portals/doc/Makefile \
          ldlm/Makefile obdecho/Makefile ptlrpc/Makefile liblustre/Makefile \
	  lov/Makefile osc/Makefile mdc/Makefile mds/Makefile ost/Makefile \
	  cobd/Makefile ptlbd/Makefile conf/Makefile  tests/Makefile \
	  utils/Makefile utils/Lustre/Makefile obdfilter/Makefile \
          obdclass/Makefile llite/Makefile doc/Makefile scripts/Makefile \
	  scripts/lustre.spec])
