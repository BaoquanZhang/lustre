default: all

MODULES := ldiskfs2

# copy makefile over to not break patches
ext3_extra := $(wildcard @LINUX@/fs/ext3/Makefile)

ext3_headers := $(wildcard @LINUX@/fs/ext3/*.h)
linux_headers := $(wildcard @LINUX@/include/linux/ext3*.h)

ext3_sources := $(filter-out %.mod.c,$(wildcard @LINUX@/fs/ext3/*.c))
new_sources := iopen.c iopen.h extents.c mballoc.c group.h
new_headers := ext3_extents.h
ldiskfs2_patched_sources := $(notdir $(ext3_sources) $(ext3_headers)) $(new_sources) $(new_headers)
ldiskfs2_sources := $(ldiskfs2_patched_sources)

ldiskfs2-objs := $(filter %.o,$(ldiskfs2_sources:.c=.o))

EXTRA_PRE_CFLAGS := -I@LINUX@/fs -I@LUSTRE@ -I@LUSTRE@/ldiskfs2

@INCLUDE_RULES@
