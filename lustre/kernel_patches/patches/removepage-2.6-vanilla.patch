 include/linux/fs.h |    1 +
 mm/filemap.c       |    3 +++
 2 files changed, 4 insertions(+)

Index: linux-2.6.6/include/linux/fs.h
===================================================================
--- linux-2.6.6.orig/include/linux/fs.h	2004-06-22 20:21:38.000000000 -0400
+++ linux-2.6.6/include/linux/fs.h	2004-06-22 20:22:35.000000000 -0400
@@ -321,6 +321,7 @@
 	int (*releasepage) (struct page *, int);
 	ssize_t (*direct_IO)(int, struct kiocb *, const struct iovec *iov,
 			loff_t offset, unsigned long nr_segs);
+	void (*removepage)(struct page *); /* called when page gets removed from the inode */
 };
 
 struct backing_dev_info;
Index: linux-2.6.6/mm/filemap.c
===================================================================
--- linux-2.6.6.orig/mm/filemap.c	2004-05-09 22:32:27.000000000 -0400
+++ linux-2.6.6/mm/filemap.c	2004-06-22 20:23:54.000000000 -0400
@@ -112,6 +112,9 @@
 	if (unlikely(!PageLocked(page)))
 		PAGE_BUG(page);
 
+	if (mapping->a_ops->removepage)
+		mapping->a_ops->removepage(page);
+
 	spin_lock_irq(&mapping->tree_lock);
 	__remove_from_page_cache(page);
 	spin_unlock_irq(&mapping->tree_lock);
