--- drivers/block/loop.c.bu	2004-05-11 16:27:23.000000000 -0700
+++ drivers/block/loop.c	2004-05-11 16:28:50.000000000 -0700
@@ -978,7 +978,7 @@ static int lo_release(struct inode *inod
 
 	lo = &loop_dev[dev];
 
-	if (!(lo->lo_flags & LO_FLAGS_READ_ONLY)) {
+	if (!(lo->lo_flags & LO_FLAGS_READ_ONLY) && lo->lo_device != 0) {
 		fsync_dev(lo->lo_device);
 		invalidate_buffers(lo->lo_device);
 	}
