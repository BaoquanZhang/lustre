 ext2/super.c        |    3 +--
 ext3/ext3-exports.c |   13 +++++++++++++
 2 files changed, 14 insertions(+), 2 deletions(-)

Index: linux-2.4.19/fs/ext2/super.c
===================================================================
--- linux-2.4.19.orig/fs/ext2/super.c	2004-04-23 17:53:55.000000000 -0400
+++ linux-2.4.19/fs/ext2/super.c	2004-04-23 22:30:41.000000000 -0400
@@ -70,6 +70,7 @@
 {
 	va_list args;
 
+	ext2_xattr_put_super(sb);
 	if (!(sb->s_flags & MS_RDONLY)) {
 		sb->u.ext2_sb.s_mount_state |= EXT2_ERROR_FS;
 		sb->u.ext2_sb.s_es->s_state =
Index: linux-2.4.19/fs/ext3/super.c
===================================================================
--- linux-2.4.19.orig/fs/ext3/super.c	2004-04-23 18:26:27.000000000 -0400
+++ linux-2.4.19/fs/ext3/super.c	2004-04-23 22:30:41.000000000 -0400
@@ -1827,8 +1827,6 @@
 	exit_ext3_xattr();
 }
 
-EXPORT_SYMBOL(ext3_force_commit);
-EXPORT_SYMBOL(ext3_bread);
 
 MODULE_AUTHOR("Remy Card, Stephen Tweedie, Andrew Morton, Andreas Dilger, Theodore Ts'o and others");
 MODULE_DESCRIPTION("Second Extended Filesystem with journaling extensions");
Index: linux-2.4.19/fs/ext3/ext3-exports.c
===================================================================
--- linux-2.4.19.orig/fs/ext3/ext3-exports.c	2003-01-30 05:24:37.000000000 -0500
+++ linux-2.4.19/fs/ext3/ext3-exports.c	2004-04-23 22:30:41.000000000 -0400
@@ -0,0 +1,13 @@
+#include <linux/config.h>
+#include <linux/module.h>
+#include <linux/ext3_fs.h>
+#include <linux/ext3_jbd.h>
+#include <linux/ext3_xattr.h>
+
+EXPORT_SYMBOL(ext3_force_commit);
+EXPORT_SYMBOL(ext3_bread);
+EXPORT_SYMBOL(ext3_xattr_register);
+EXPORT_SYMBOL(ext3_xattr_unregister);
+EXPORT_SYMBOL(ext3_xattr_get);
+EXPORT_SYMBOL(ext3_xattr_list);
+EXPORT_SYMBOL(ext3_xattr_set);
Index: linux-2.4.19/fs/ext3/Makefile
===================================================================
--- linux-2.4.19.orig/fs/ext3/Makefile	2004-04-23 18:26:27.000000000 -0400
+++ linux-2.4.19/fs/ext3/Makefile	2004-04-23 23:05:20.000000000 -0400
@@ -9,7 +9,7 @@
 
 O_TARGET := ext3.o
 
-export-objs :=	super.o inode.o
+export-objs :=	ext3-exports.c
 
 obj-y    := balloc.o bitmap.o dir.o file.o fsync.o ialloc.o inode.o \
 		ioctl.o namei.o super.o symlink.o hash.o
