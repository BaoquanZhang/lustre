Index: chaos88/fs/ext3/inode.c
===================================================================
--- chaos88.orig/fs/ext3/inode.c	Wed Jun 23 20:53:00 2004
+++ chaos88/fs/ext3/inode.c	Wed Jun 23 20:55:49 2004
@@ -2225,6 +2225,10 @@
 
 	memcpy(nei->i_data, oei->i_data, sizeof(nei->i_data));
 	memset(oei->i_data, 0, sizeof(oei->i_data));
+	if (EXT3_I(old_inode)->i_flags & EXT3_EXTENTS_FL) {
+		EXT3_I(new_inode)->i_flags |= EXT3_EXTENTS_FL;
+ 		ext3_extents_initialize_blockmap(handle, old_inode);
+	}
 
 	nei->i_disksize = oei->i_disksize;
 	nei->i_state |= EXT3_STATE_DELETE;
@@ -2463,6 +2467,12 @@
 
 	brelse (iloc.bh);
 
+	if (EXT3_I(inode)->i_flags & EXT3_EXTENTS_FL) {
+		inode->u.ext3_i.i_cached_extent[0] = 0;
+		inode->u.ext3_i.i_cached_extent[1] = 0;
+		inode->u.ext3_i.i_cached_extent[2] = 0;
+	}
+
 	if (S_ISREG(inode->i_mode)) {
 		inode->i_op = &ext3_file_inode_operations;
 		inode->i_fop = &ext3_file_operations;
